{
	"builders": [
		{
			"type": "virtualbox-iso",
			"boot_command": [
				"<esc>",
				"<wait>linux ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/anaconda-ks.cfg<enter>"
			],
			"boot_wait": "5s",
			"disk_size": 40000,
			"guest_os_type": "RedHat_64",
			"headless": true,
			"http_directory": "./http_directory",
			"iso_checksum": "111379a06402e1e445c6aeee9401d031",
			"iso_checksum_type": "md5",
			"iso_urls": [
				"http://mirror.clarkson.edu/centos/7/isos/x86_64/CentOS-7-x86_64-NetInstall-1503.iso",
				"http://mirrors.xmission.com/centos/7/isos/x86_64/CentOS-7-x86_64-NetInstall-1503.iso",
				"http://repos.mia.quadranet.com/centos/7/isos/x86_64/CentOS-7-x86_64-NetInstall-1503.iso"
			],
			"output_directory": "/tmp/packer-virtualbox",
			"shutdown_command": "shutdown -P now",
			"ssh_password": "vagrant",
			"ssh_username": "root",
			"guest_additions_sha256": "2a87971ae3c7e57e87713967a6f242acbdafcc09b635cba98e6dd3a7f5292d3b"
		},
		{
			"type": "vmware-iso",	 
			"boot_command": [
				"<esc>",
				"<wait>linux ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/anaconda-ks.cfg<enter>"
			],
			"boot_wait": "5s",
			"disk_size": 40000,
			"guest_os_type": "linux",
			"headless": true,
			"http_directory": "./http_directory",
			"iso_checksum": "111379a06402e1e445c6aeee9401d031",
			"iso_checksum_type": "md5",
			"iso_urls": [
				"http://mirror.clarkson.edu/centos/7/isos/x86_64/CentOS-7-x86_64-NetInstall-1503.iso",
				"http://mirrors.xmission.com/centos/7/isos/x86_64/CentOS-7-x86_64-NetInstall-1503.iso",
				"http://repos.mia.quadranet.com/centos/7/isos/x86_64/CentOS-7-x86_64-NetInstall-1503.iso"
			],
			"output_directory": "/tmp/packer-vmware",
			"shutdown_command": "shutdown -P now",
			"ssh_password": "vagrant",
			"ssh_username": "root",
			"tools_upload_flavor": "linux"
		},
		{
			"type": "amazon-ebs",
			"ami_name": "centos-7_0-64_percona {{timestamp}}",
			"instance_type": "t2.micro",
			"region": "us-east-1", 
			"source_ami": "ami-1609da7e",
			"subnet_id": "subnet-ad6c5e97",
			"vpc_id": "vpc-0ec6f06b",
			"associate_public_ip_address": "true",
			"ami_virtualization_type": "hvm",
			"ssh_timeout": "5m",
			"ssh_username": "centos",
			"ami_groups": [ "all" ]
		}
	],
	"post-processors": [
		{
			"output": "boxes/centos-7-64_percona_{{.Provider}}.box",
			"override": {
				"aws": {
					"output": "boxes/centos-7-64_percona_{{.Provider}}.box"
				}
			},
			"type": "vagrant"
		}
	],
	"provisioners": [
		{
			"script": "provisioners/package-upgrades.sh",
			"type": "shell",
			"override": {
				"amazon-ebs": {
					"execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'"
				}
			}
		},
		{
			"script": "provisioners/install-useful-packages.sh",
			"type": "shell",
			"override": {
				"amazon-ebs": {
					"execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'"
				}
			}
		},
		{
			"script": "provisioners/no-tty-sudo.sh",
			"override": {
				"amazon-ebs": {
					"execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'"
				}
			},
			"type": "shell"
		},
		{
			"script": "provisioners/disable-security.sh",
			"type": "shell",
			"override": {
				"amazon-ebs": {
					"execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'"
				}
			}
		},
		{
			"script": "provisioners/disable-ssh-usedns.sh",
			"type": "shell",
			"override": {
				"amazon-ebs": {
					"execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'"
				}
			}
		},
		{
			"script": "provisioners/ec2-set-device-names.sh",
			"type": "shell",
			"override": {
				"amazon-ebs": {
					"execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'"
				}
			}
		},
		{
			"override": {
				"amazon-ebs": {
					"execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'",
					"script": "provisioners/prepare-ec2-ssh-key.sh"
				}
			},
			"script": "provisioners/prepare-vagrant-ssh-key.sh",
			"type": "shell"
		},
		{
			"script": "provisioners/prepare-vagrant-user.sh",
			"type": "shell",
			"override": {
				"amazon-ebs": {
					"execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'"
				}
			}
		},
		{
			"script": "provisioners/modify-cloud-init-config.sh",
			"type": "shell",
			"override": {
				"amazon-ebs": {
					"execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'"
				}
			}
		},
		{
			"script": "provisioners/install-guest-additions.sh",
			"type": "shell",
			"override": {
				"amazon-ebs": {
					"execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'"
				}
			}
		},
		{
			"script": "provisioners/prepare-udev.sh",
			"type": "shell",
			"override": {
				"amazon-ebs": {
					"execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'"
				}
			}
		},
		{
			"script": "provisioners/remove-extra-locales.sh",
			"type": "shell",
			"override": {
				"amazon-ebs": {
					"execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'"
				}
			}
		},
		{
			"script": "provisioners/clean-empty-space.sh",
			"type": "shell",
			"override": {
				"amazon-ebs": {
					"execute_command": "chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'"
				}
			}
		}
	]
}

